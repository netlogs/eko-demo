## Eko Demo é¡¹ç›®è¯¦ç»†åˆ†æ

 - åŠŸèƒ½ï¼šæœç´¢Sam Altmançš„ä¿¡æ¯å¹¶æ•´ç†æˆmarkdownæ ¼å¼å¯¼å‡º
  - Agentç±»å‹ï¼šEkoæ¡†æ¶è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„Agentï¼ˆä¸»è¦æ˜¯Browser Agentï¼‰
  - è°ƒç”¨çš„Toolsï¼š
    - æµè§ˆå™¨æ“ä½œå·¥å…·ï¼ˆæœç´¢ã€é¡µé¢å¯¼èˆªï¼‰
    - ä¿¡æ¯æå–å·¥å…·
    - æ–‡æœ¬å¤„ç†å’Œmarkdownæ ¼å¼åŒ–å·¥å…·
  - æŠ€æœ¯æ ˆï¼šChromeæ‰©å±• + TypeScript + Webpack

  2. web-demo-login-autotest (Webç™»å½•è‡ªåŠ¨åŒ–æµ‹è¯•)

  - åŠŸèƒ½ï¼šå¯¹ç™»å½•é¡µé¢è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼ŒåŒ…æ‹¬å„ç§ç”¨æˆ·å/å¯†ç ç»„åˆæµ‹è¯•ï¼Œæœ€åç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
  - Agentç±»å‹ï¼šBaseBrowserAgentï¼ˆæµè§ˆå™¨æ“ä½œä»£ç†ï¼‰
  - è°ƒç”¨çš„Toolsï¼š
    - è¡¨å•å¡«å†™å·¥å…·
    - é¡µé¢äº¤äº’å·¥å…·ï¼ˆç‚¹å‡»ã€è¾“å…¥ï¼‰
    - æµ‹è¯•éªŒè¯å·¥å…·
    - æŠ¥å‘Šç”Ÿæˆå·¥å…·
  - æŠ€æœ¯æ ˆï¼šReact + TypeScriptï¼Œä½¿ç”¨ClaudeProvider

  3. node-format-dir (æ–‡ä»¶ç®¡ç†)

  - åŠŸèƒ½ï¼šåˆ—å‡ºç›®å½•å†…å®¹å¹¶æ ¼å¼åŒ–æ˜¾ç¤ºï¼ˆåŒ…å«æ–‡ä»¶å¤§å°ã€ä¿®æ”¹æ—¥æœŸï¼‰ï¼Œä¿å­˜åˆ°contents.txtæ–‡ä»¶
  - Agentç±»å‹ï¼šBaseFileAgentï¼ˆæ–‡ä»¶æ“ä½œä»£ç†ï¼‰
  - è°ƒç”¨çš„Toolsï¼š
    - è‡ªå®šä¹‰çš„DirectoryFormatterå·¥å…·
    - æ–‡ä»¶è¯»å†™å·¥å…·
    - ç›®å½•åˆ—è¡¨å·¥å…·
  - æŠ€æœ¯æ ˆï¼šNode.js + TypeScript + dotenv

  4. browser-extension-stock (è‚¡ç¥¨ä¿¡æ¯æ”¶é›†)

  - åŠŸèƒ½ï¼šæ”¶é›†è‚¡ç¥¨ä¿¡æ¯å¹¶ç”Ÿæˆå¯è§†åŒ–åˆ†ææŠ¥å‘Š
  - Agentç±»å‹ï¼šBaseBrowserAgent + è‡ªå®šä¹‰GenerateReportå·¥å…·
  - è°ƒç”¨çš„Toolsï¼š
    - æµè§ˆå™¨æ•°æ®æŠ“å–å·¥å…·
    - è‡ªå®šä¹‰GenerateReportå·¥å…·ï¼ˆç”ŸæˆReactå¯è§†åŒ–ç»„ä»¶ï¼‰
    - æ•°æ®åˆ†æå·¥å…·
  - æŠ€æœ¯æ ˆï¼šChromeæ‰©å±• + React + Antd + Rechartså›¾è¡¨åº“

  5. browser-extension-blog (ç ”ç©¶ã€å†™ä½œã€å‘å¸ƒåšå®¢)

  - åŠŸèƒ½ï¼šåŸºäºFellouAI/ekoçš„READMEç ”ç©¶ç«äº‰å¯¹æ‰‹ï¼Œçªå‡ºEkoçš„å…³é”®è´¡çŒ®ï¼Œå†™åšå®¢æ¨å¹¿Ekoå¹¶å‘å¸ƒåˆ°Write.as
  - Agentç±»å‹ï¼šBaseBrowserAgentï¼ˆæµè§ˆå™¨æ“ä½œä»£ç†ï¼‰
  - è°ƒç”¨çš„Toolsï¼š
    - GitHubä¿¡æ¯æŠ“å–å·¥å…·
    - ç«å“åˆ†æå·¥å…·
    - æ–‡æœ¬å†™ä½œå·¥å…·
    - åšå®¢å‘å¸ƒå·¥å…·ï¼ˆWrite.aså¹³å°ï¼‰
  - æŠ€æœ¯æ ˆï¼šChromeæ‰©å±• + TypeScript

  Ekoæ¡†æ¶ä¸­çš„Agentç±»å‹

  ä»æºç åˆ†æï¼ŒEkoæä¾›ä»¥ä¸‹å‡ ç§æ ¸å¿ƒAgentï¼š

  1. BaseChatAgent - èŠå¤©åŠ©æ‰‹ä»£ç†ï¼Œå¤„ç†éä»»åŠ¡ç›¸å…³çš„å¯¹è¯
  2. BaseFileAgent - æ–‡ä»¶æ“ä½œä»£ç†ï¼Œå¤„ç†æ–‡ä»¶åˆ›å»ºã€æŸ¥æ‰¾ã€è¯»å–ã€ä¿®æ”¹ç­‰
  3. BaseShellAgent - Shellå‘½ä»¤ä»£ç†ï¼Œæ‰§è¡Œbashå‘½ä»¤
  4. BaseComputerAgent - è®¡ç®—æœºæ“ä½œä»£ç†ï¼Œé€šè¿‡é¼ æ ‡é”®ç›˜ä¸è®¡ç®—æœºäº¤äº’
  5. BaseBrowserAgent - æµè§ˆå™¨æ“ä½œä»£ç†ï¼ˆåŒ…å«ä¸‰ä¸ªå­ç±»å‹ï¼‰ï¼š

    - BaseBrowserLabelsAgent - åŸºäºæ ‡ç­¾çš„æµè§ˆå™¨æ“ä½œ
    - BaseBrowserScreenAgent - åŸºäºå±å¹•æˆªå›¾çš„æµè§ˆå™¨æ“ä½œ

  Ekoæ¡†æ¶ä¸­çš„Tools

  æ ¸å¿ƒå·¥å…·åŒ…æ‹¬ï¼š
  - ForeachTaskTool - å¾ªç¯ä»»åŠ¡å·¥å…·
  - HumanInteractTool - äººæœºäº¤äº’å·¥å…·
  - TaskNodeStatusTool - ä»»åŠ¡èŠ‚ç‚¹çŠ¶æ€å·¥å…·
  - VariableStorageTool - å˜é‡å­˜å‚¨å·¥å…·
  - WatchTriggerTool - ç›‘æ§è§¦å‘å·¥å…·
  - McpTool - MCPå·¥å…·åŒ…è£…å™¨

  è¿™äº›demoå±•ç¤ºäº†Ekoæ¡†æ¶çš„å¼ºå¤§èƒ½åŠ›ï¼šé€šè¿‡è‡ªç„¶è¯­è¨€æè¿°ç”Ÿæˆå·¥ä½œæµï¼Œç„¶åè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„Agentå’ŒToolsæ¥æ‰§è¡Œå¤æ‚çš„
  è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚



## æé—®



ç”¨æˆ·ç‚¹å‡»RunæŒ‰é’®
        â†“
    handleClick() å‘é€ {type: "run"} æ¶ˆæ¯
        â†“
    Background Script æ¥æ”¶æ¶ˆæ¯
        â†“
    è°ƒç”¨ main() å‡½æ•°
        â†“
    åˆå§‹åŒ– Eko(config)
        â†“
    eko.generate(prompt) - AIè§„åˆ’é˜¶æ®µ
        â†“
    Planner.plan() - LLMç”Ÿæˆworkflow XML
        â†“
    parseWorkflow() - è§£æXMLä¸ºå¯æ‰§è¡Œç»“æ„
        â†“
    eko.execute(workflow) - æ‰§è¡Œé˜¶æ®µ
        â†“
    doRunWorkflow() - éå†Agentæ‰§è¡Œæ ‘
        â†“
    runAgent() - æ‰§è¡Œå…·ä½“Agent (Browser/File)
        â†“
    Agent.run() - è°ƒç”¨å…·ä½“å·¥å…· (navigate_to/file_writeç­‰)
  è¿™ä¸ªæµç¨‹æ˜¯ /mnt/e/devlop/2025/github/eko-demos/browser-extension-quickstartè¿™ä¸ªç¤ºä¾‹ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œ
  å…¶æ ¸å¿ƒæ‰§è¡Œçš„Agentï¼Œ å…·ä½“è°ƒç”¨çš„å·¥å…·ï¼Œ è¿™ä¸ªAgentéƒ½æœ‰å“ªäº›å·¥å…·ï¼Œç»™æˆ‘åœ¨æºç é‡Œé¢å®šä½ä¸€ä¸‹æ‰¾æ‰¾ï¼Œ æˆ‘è¦å­¦ä¹ ä¸€ä¸‹

## å›ç­”

åŸºäºå¯¹æºç çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä¸ºæ‚¨è¯¦ç»†æ¢³ç†äº†å®Œæ•´çš„æ‰§è¡Œæµç¨‹å’Œæ ¸å¿ƒç»„ä»¶ï¼š

  1. æ‰§è¡Œæµç¨‹å…¥å£ ğŸ“

  ç”¨æˆ·ç‚¹å‡»RunæŒ‰é’® â†’ handleClick()å‘é€æ¶ˆæ¯
  // /mnt/e/devlop/2025/github/eko-demos/browser-extension-quickstart/src/popup/index.tsx:50
  chrome.runtime.sendMessage({ type: "run" });

  Background Scriptæ¥æ”¶æ¶ˆæ¯ â†’ è°ƒç”¨main()å‡½æ•°
  // /mnt/e/devlop/2025/github/eko-demos/browser-extension-quickstart/src/background/index.ts:16-20
  chrome.runtime.onMessage.addListener(async function (request, sender, sendResponse) {
    if (request.type == "run") {
      await main(); // è°ƒç”¨first_workflow.tsä¸­çš„mainå‡½æ•°
    }
  });

  2. Ekoæ¡†æ¶åˆå§‹åŒ–å’Œå·¥ä½œæµç”Ÿæˆ ğŸ”§

  åˆå§‹åŒ–Eko â†’ eko.generate()ç”Ÿæˆå·¥ä½œæµ
  //
  /mnt/e/devlop/2025/github/eko-demos/browser-extension-quickstart/src/background/first_workflow.ts:15-23
  let eko = new Eko(config as EkoConfig);
  const workflow = await eko.generate(`
    Search Sam Altman's information and summarize it into markdown format for export
  `);

  Planner.plan() - æ ¸å¿ƒè§„åˆ’å™¨
  // /mnt/e/devlop/2025/github/eko/packages/eko-core/src/core/plan.ts:44-45
  const planner = new Planner(context);
  context.workflow = await planner.plan(taskPrompt);

  LLMç”Ÿæˆworkflow XML â†’ parseWorkflow()è§£æ
  // /mnt/e/devlop/2025/github/eko/packages/eko-core/src/core/plan.ts:147-152
  let workflow = parseWorkflow(taskId, streamText, true, thinkingText) as Workflow;

  3. å·¥ä½œæµæ‰§è¡Œå¼•æ“ âš™ï¸

  eko.execute(workflow) â†’ doRunWorkflow()
  // /mnt/e/devlop/2025/github/eko/packages/eko-core/src/core/index.ts:127-214
  private async doRunWorkflow(context: Context): Promise<EkoResult> {
    // æ„å»ºAgentæ‰§è¡Œæ ‘
    let agentTree = buildAgentTree(workflow.agents);
    // éå†æ‰§è¡ŒAgent
    while (true) {
      agentTree.result = await this.runAgent(context, agent, agentTree, agentChain);
    }
  }

  runAgent() â†’ Agent.run()
  // /mnt/e/devlop/2025/github/eko/packages/eko-core/src/core/index.ts:233
  agentNode.result = await agent.run(context, agentChain);

  4. Browser Agentæ ¸å¿ƒå®ç° ğŸŒ

  ä½¿ç”¨çš„Agentç±»å‹: BaseBrowserLabelsAgent (åŸºäºå…ƒç´ ç´¢å¼•æ“ä½œ)
  // /mnt/e/devlop/2025/github/eko/packages/eko-extension/src/browser.ts:3
  export default class BrowserAgent extends BaseBrowserLabelsAgent

  Browser Agentçš„æ ¸å¿ƒå·¥å…·é›†:

  å¯¼èˆªå·¥å…·

  - navigate_to: å¯¼èˆªåˆ°æŒ‡å®šURL
  - current_page: è·å–å½“å‰é¡µé¢ä¿¡æ¯
  - go_back: æµè§ˆå™¨å†å²åé€€

  é¡µé¢äº¤äº’å·¥å…·

  - input_text: å‘å…ƒç´ è¾“å…¥æ–‡æœ¬
  - click_element: ç‚¹å‡»é¡µé¢å…ƒç´ (æ”¯æŒå…ƒç´ ç´¢å¼•)
  - hover_to_element: é¼ æ ‡æ‚¬åœåˆ°å…ƒç´ 

  é¡µé¢æ“ä½œå·¥å…·

  - scroll_mouse_wheel: é¼ æ ‡æ»šè½®æ»šåŠ¨
  - extract_page_content: æå–é¡µé¢å†…å®¹
  - screenshot: é¡µé¢æˆªå›¾(Chromeæ‰©å±•APIå®ç°)

  æ ‡ç­¾é¡µç®¡ç†å·¥å…·

  - get_all_tabs: è·å–æ‰€æœ‰æµè§ˆå™¨æ ‡ç­¾é¡µ
  - switch_tab: åˆ‡æ¢åˆ°æŒ‡å®šæ ‡ç­¾é¡µ

  ä¸‹æ‹‰é€‰æ‹©å·¥å…·

  - get_select_options: è·å–ä¸‹æ‹‰é€‰æ‹©æ¡†é€‰é¡¹
  - select_option: é€‰æ‹©ä¸‹æ‹‰é€‰æ‹©æ¡†é€‰é¡¹

  è¾…åŠ©å·¥å…·

  - wait: ç­‰å¾…æŒ‡å®šæ—¶é—´

  5. å…³é”®æºç ä½ç½®å®šä½ ğŸ“‚

  | ç»„ä»¶             | æºç ä½ç½®
   | æ ¸å¿ƒåŠŸèƒ½                         |
  |----------------|--------------------------------------------------------------------------------|----
  --------------------------|
  | æ‰§è¡Œå…¥å£           | /eko-demos/browser-extension-quickstart/src/background/first_workflow.ts:18-23 |
   eko.generate()å’Œeko.execute() |
  | è§„åˆ’å™¨            | /eko-core/src/core/plan.ts:25-58                                               |
  Planner.plan()ç”Ÿæˆå·¥ä½œæµ          |
  | æ‰§è¡Œå¼•æ“           | /eko-core/src/core/index.ts:127-214                                            |
   doRunWorkflow()éå†Agentæ ‘      |
  | AgentåŸºç±»        | /eko-core/src/agent/base.ts:69-100                                             |
  Agent.run()æ‰§è¡Œé€»è¾‘              |
  | Browser Agent  | /eko-extension/src/browser.ts:3                                                |
  ç»§æ‰¿BaseBrowserLabelsAgent     |
  | Labels Agentå·¥å…· | /eko-core/src/agent/browser/browser_labels.ts                                  |
  buildInitTools()å®šä¹‰å·¥å…·é›†        |
  | XMLè§£æå™¨         | /eko-core/src/common/xml.ts:13-105                                             |
  parseWorkflow()è§£æLLMè¾“å‡º       |

  6. æ‰§è¡Œç¤ºä¾‹æµç¨‹ ğŸ”„

  å¯¹äº"æœç´¢Sam Altmanä¿¡æ¯"è¿™ä¸ªä»»åŠ¡ï¼ŒEkoä¼šï¼š

  1. LLMè§„åˆ’é˜¶æ®µ: ç”ŸæˆåŒ…å«Browser Agentçš„XMLå·¥ä½œæµ
  2. Agentæ‰§è¡Œé˜¶æ®µ: Browser Agentä½¿ç”¨ä»¥ä¸‹å·¥å…·åºåˆ—ï¼š

    - navigate_to: å¯¼èˆªåˆ°æœç´¢å¼•æ“
    - input_text: è¾“å…¥"Sam Altman"
    - click_element: ç‚¹å‡»æœç´¢æŒ‰é’®
    - extract_page_content: æå–æœç´¢ç»“æœ
    - navigate_to: è®¿é—®ç›¸å…³é“¾æ¥
    - extract_page_content: æå–è¯¦ç»†ä¿¡æ¯
    - é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°æ”¶é›†è¶³å¤Ÿä¿¡æ¯

  è¿™ä¸ªæ¡†æ¶çš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°è‡ªåŠ¨ç”Ÿæˆå¯æ‰§è¡Œçš„Agentå·¥ä½œæµï¼Œç„¶åç”±ä¸“é—¨çš„Agentä½¿ç”¨å¯¹åº”çš„å·¥å…·é›†æ¥å®Œ
  æˆå¤æ‚çš„è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚



## æé—®

 éƒ½æœ‰å“ªäº›å·¥å…·ï¼ŸæŠŠBrowser Agentçš„æ‰€æœ‰å·¥å…·ç»™æˆ‘åˆ—å‡ºæ¥ï¼ŒåŒæ—¶å‘Šè¯‰æˆ‘å·¥å…·ä»£ç æ‰€åœ¨çš„ä½ç½®ï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨ï¼Ÿ
  å¦‚ä½•é›†æˆåˆ°Browser Agenté‡Œé¢

## å›ç­”

â— Browser Agentå·¥å…·å®Œæ•´æŒ‡å—

  ğŸ”§ Browser Agentå·¥å…·æ€»è§ˆ

  Browser Agentæä¾›ä¸¤ç§æ“ä½œæ¨¡å¼ï¼Œæ¯ç§éƒ½æœ‰ä¸“é—¨çš„å·¥å…·é›†ï¼š

  1. BaseBrowserLabelsAgent (åŸºäºå…ƒç´ ç´¢å¼•æ“ä½œ) â­

  ä»£ç ä½ç½®: /packages/eko-core/src/agent/browser/browser_labels.ts:203-552

  ğŸ“ å¯¼èˆªå·¥å…·

| å·¥å…·å       | åŠŸèƒ½             | å‚æ•°        | ä»£ç ä½ç½®  |
| ------------ | ---------------- | ----------- | --------- |
| navigate_to  | å¯¼èˆªåˆ°æŒ‡å®šURL    | url: string | 206-226è¡Œ |
| current_page | è·å–å½“å‰é¡µé¢ä¿¡æ¯ | æ—           | 228-242è¡Œ |
| go_back      | æµè§ˆå™¨å†å²åé€€   | æ—           | 244-256è¡Œ |

  ğŸ–±ï¸ é¡µé¢äº¤äº’å·¥å…·

  | å·¥å…·å              | åŠŸèƒ½      | å‚æ•°                                                             |
  ä»£ç ä½ç½®     |
  |------------------|---------|----------------------------------------------------------------|--------
  --|
  | input_text       | å‘å…ƒç´ è¾“å…¥æ–‡æœ¬ | index: number, text: string, enter?: boolean                   |
  258-293è¡Œ |
  | click_element    | ç‚¹å‡»é¡µé¢å…ƒç´   | index: number, num_clicks?: number, button?: left/right/middle |
  295-329è¡Œ |
  | hover_to_element | é¼ æ ‡æ‚¬åœåˆ°å…ƒç´  | index: number                                                  |
  395-415è¡Œ |

  ğŸ“œ æ»šåŠ¨å’Œå†…å®¹å·¥å…·

  | å·¥å…·å                  | åŠŸèƒ½     | å‚æ•°
       | ä»£ç ä½ç½®     |
  |----------------------|--------|--------------------------------------------------------------------|-
  ---------|
  | scroll_mouse_wheel   | é¼ æ ‡æ»šè½®æ»šåŠ¨ | amount: number, direction: up/down, extract_page_content?:
  boolean | 355-393è¡Œ |
  | extract_page_content | æå–é¡µé¢å†…å®¹ | æ— 
       | 417-432è¡Œ |

  ğŸ¯ ä¸‹æ‹‰é€‰æ‹©å·¥å…·

| å·¥å…·å             | åŠŸèƒ½               | å‚æ•°                          | ä»£ç ä½ç½®  |
| ------------------ | ------------------ | ----------------------------- | --------- |
| get_select_options | è·å–ä¸‹æ‹‰é€‰æ‹©æ¡†é€‰é¡¹ | index: number                 | 434-455è¡Œ |
| select_option      | é€‰æ‹©ä¸‹æ‹‰é€‰æ‹©æ¡†é€‰é¡¹ | index: number, option: string | 457-486è¡Œ |

  ğŸ—‚ï¸ æ ‡ç­¾é¡µç®¡ç†å·¥å…·

| å·¥å…·å       | åŠŸèƒ½                 | å‚æ•°          | ä»£ç ä½ç½®  |
| ------------ | -------------------- | ------------- | --------- |
| get_all_tabs | è·å–æ‰€æœ‰æµè§ˆå™¨æ ‡ç­¾é¡µ | æ—             | 488-502è¡Œ |
| switch_tab   | åˆ‡æ¢åˆ°æŒ‡å®šæ ‡ç­¾é¡µ     | tabId: number | 504-524è¡Œ |

  â±ï¸ è¾…åŠ©å·¥å…·

| å·¥å…·å | åŠŸèƒ½         | å‚æ•°                           | ä»£ç ä½ç½®  |
| ------ | ------------ | ------------------------------ | --------- |
| wait   | ç­‰å¾…æŒ‡å®šæ—¶é—´ | duration: number (200-10000ms) | 526-551è¡Œ |

  2. BaseBrowserScreenAgent (åŸºäºåæ ‡æ“ä½œ) ğŸ“Œ

  ä»£ç ä½ç½®: /packages/eko-core/src/agent/browser/browser_screen.ts:74-398

  ğŸ“ å¯¼èˆªå·¥å…·

| å·¥å…·å       | åŠŸèƒ½             | å‚æ•°        | ä»£ç ä½ç½®  |
| ------------ | ---------------- | ----------- | --------- |
| navigate_to  | å¯¼èˆªåˆ°æŒ‡å®šURL    | url: string | 77-97è¡Œ   |
| current_page | è·å–å½“å‰é¡µé¢ä¿¡æ¯ | æ—           | 99-113è¡Œ  |
| go_back      | æµè§ˆå™¨å†å²åé€€   | æ—           | 115-127è¡Œ |

  ğŸ–±ï¸ é¼ æ ‡æ“ä½œå·¥å…·

  | å·¥å…·å           | åŠŸèƒ½        | å‚æ•°
      | ä»£ç ä½ç½®     |
  |---------------|-----------|-----------------------------------------------------------------------|--
  --------|
  | click         | åœ¨æŒ‡å®šåæ ‡ç‚¹å‡»   | x: number, y: number, num_clicks?: number, button?:
  left/right/middle | 151-193è¡Œ |
  | move_to       | ç§»åŠ¨é¼ æ ‡åˆ°æŒ‡å®šåæ ‡ | x: number, y: number
        | 195-219è¡Œ |
  | drag_and_drop | æ‹–æ‹½æ“ä½œ      | x1: number, y1: number, x2: number, y2: number
   | 294-332è¡Œ |

  âŒ¨ï¸ é”®ç›˜æ“ä½œå·¥å…·

| å·¥å…·å | åŠŸèƒ½         | å‚æ•°                                  | ä»£ç ä½ç½®  |
| ------ | ------------ | ------------------------------------- | --------- |
| typing | è¾“å…¥æŒ‡å®šæ–‡æœ¬ | text: string                          | 129-149è¡Œ |
| press  | æŒ‰é”®æ“ä½œ     | key: enter/tab/space/backspace/delete | 270-293è¡Œ |

  ğŸ“œ é¡µé¢æ“ä½œå·¥å…·

| å·¥å…·å               | åŠŸèƒ½         | å‚æ•°                               | ä»£ç ä½ç½®  |
| -------------------- | ------------ | ---------------------------------- | --------- |
| scroll               | é¼ æ ‡æ»šè½®æ»šåŠ¨ | amount: number, direction: up/down | 221-251è¡Œ |
| extract_page_content | æå–ç½‘é¡µå†…å®¹ | æ—                                  | 253-268è¡Œ |

  ğŸ—‚ï¸ æ ‡ç­¾é¡µç®¡ç†å·¥å…·

| å·¥å…·å       | åŠŸèƒ½                 | å‚æ•°          | ä»£ç ä½ç½®  |
| ------------ | -------------------- | ------------- | --------- |
| get_all_tabs | è·å–æ‰€æœ‰æµè§ˆå™¨æ ‡ç­¾é¡µ | æ—             | 334-348è¡Œ |
| switch_tab   | åˆ‡æ¢åˆ°æŒ‡å®šæ ‡ç­¾é¡µ     | tabId: number | 350-370è¡Œ |

  â±ï¸ è¾…åŠ©å·¥å…·

| å·¥å…·å | åŠŸèƒ½         | å‚æ•°                           | ä»£ç ä½ç½®  |
| ------ | ------------ | ------------------------------ | --------- |
| wait   | ç­‰å¾…æŒ‡å®šæ—¶é—´ | duration: number (200-10000ms) | 372-397è¡Œ |

  ğŸ› ï¸ å·¥å…·è°ƒç”¨æ–¹å¼

  1. åœ¨Agentå†…éƒ¨è°ƒç”¨

  // åœ¨Agentæ–¹æ³•å†…è°ƒç”¨
  protected async someMethod(agentContext: AgentContext) {
    // å¯¼èˆªåˆ°é¡µé¢
    await this.navigate_to(agentContext, "https://example.com");

    // ç‚¹å‡»å…ƒç´ (Labelsæ¨¡å¼)
    await this.click_element(agentContext, 1, 1, "left");
    
    // è¾“å…¥æ–‡æœ¬
    await this.input_text(agentContext, 2, "search text", true);
  }

  2. é€šè¿‡LLMè°ƒç”¨ (æ¨è)

  // LLMä¼šæ ¹æ®ä»»åŠ¡è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å·¥å…·
  const workflow = await eko.generate(`
    æ‰“å¼€Googleæœç´¢"Eko AIæ¡†æ¶"ç›¸å…³ä¿¡æ¯
  `);
  await eko.execute(workflow);

  3. ç›´æ¥å·¥å…·æ‰§è¡Œ

  // ç›´æ¥è°ƒç”¨å·¥å…·çš„executeæ–¹æ³•
  const result = await tool.execute(
    { url: "https://example.com" },
    agentContext
  );

  ğŸ—ï¸ å¦‚ä½•é›†æˆè‡ªå®šä¹‰å·¥å…·åˆ°Browser Agent

  1. ç»§æ‰¿ç°æœ‰Agent

  import { BaseBrowserLabelsAgent } from "@eko-ai/eko";

  export default class CustomBrowserAgent extends BaseBrowserLabelsAgent {
    constructor(llms?: string[]) {
      // ä¼ å…¥è‡ªå®šä¹‰å·¥å…·
      super(llms, [
        {
          name: "custom_tool",
          description: "è‡ªå®šä¹‰å·¥å…·æè¿°",
          parameters: {
            type: "object",
            properties: {
              param1: { type: "string" }
            },
            required: ["param1"]
          },
          execute: async (args, agentContext) => {
            // è‡ªå®šä¹‰å·¥å…·é€»è¾‘
            return await this.callInnerTool(() => {
              // å®ç°å…·ä½“åŠŸèƒ½
              return "æ‰§è¡Œç»“æœ";
            });
          }
        }
      ]);
    }
  }

  2. æ‰©å±•buildInitToolsæ–¹æ³•

  export default class ExtendedBrowserAgent extends BaseBrowserLabelsAgent {
    protected buildInitTools(): Tool[] {
      const baseTools = super.buildInitTools();

      const customTools: Tool[] = [
        {
          name: "advanced_search",
          description: "é«˜çº§æœç´¢åŠŸèƒ½",
          parameters: {
            type: "object",
            properties: {
              query: { type: "string" },
              filters: { type: "object" }
            }
          },
          execute: async (args, agentContext) => {
            // ç»„åˆä½¿ç”¨åŸºç¡€å·¥å…·å®ç°å¤æ‚åŠŸèƒ½
            await this.navigate_to(agentContext, "https://search.com");
            await this.input_text(agentContext, 1, args.query as string, true);
            return { success: true };
          }
        }
      ];
    
      return [...baseTools, ...customTools];
    }
  }

  3. ä½¿ç”¨Eko.toolsæ³¨å†Œå…¨å±€å·¥å…·

  import { Eko } from "@eko-ai/eko";

  // æ³¨å†Œå…¨å±€å·¥å…·
  Eko.tools = [
    ...Eko.tools,
    {
      name: "global_custom_tool",
      description: "å…¨å±€è‡ªå®šä¹‰å·¥å…·",
      parameters: { /* ... */ },
      execute: async (args, agentContext) => {
        // å·¥å…·å®ç°
      }
    }
  ];

  4. Chromeæ‰©å±•ç‰¹å®šå®ç°

  // /packages/eko-extension/src/browser.ts
  export default class ChromeBrowserAgent extends BaseBrowserLabelsAgent {
    protected async screenshot(agentContext: AgentContext) {
      // ä½¿ç”¨Chrome Extension APIå®ç°æˆªå›¾
      let windowId = await this.getWindowId(agentContext);
      let dataUrl = await chrome.tabs.captureVisibleTab(windowId, {
        format: "jpeg",
        quality: 60
      });
      return {
        imageBase64: dataUrl.substring(dataUrl.indexOf("base64,") + 7),
        imageType: "image/jpeg"
      };
    }

    protected async execute_script(agentContext: AgentContext, func: Function, args: any[]) {
      // ä½¿ç”¨Chrome Extension APIæ‰§è¡Œè„šæœ¬
      let tabId = await this.getTabId(agentContext);
      let frameResults = await chrome.scripting.executeScript({
        target: { tabId: tabId as number },
        func: func,
        args: args
      });
      return frameResults[0].result;
    }
  }

  ğŸ“‹ å·¥å…·å‚æ•°è¯´æ˜

  é€šç”¨å‚æ•°ç±»å‹

  - index: number - å…ƒç´ ç´¢å¼•ï¼ˆLabelsæ¨¡å¼ä¸“ç”¨ï¼‰
  - x, y: number - å±å¹•åæ ‡ï¼ˆScreenæ¨¡å¼ä¸“ç”¨ï¼‰
  - url: string - ç½‘é¡µURL
  - text: string - è¾“å…¥æ–‡æœ¬
  - duration: number - ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  - tabId: number - æ ‡ç­¾é¡µID
  - button: "left" | "right" | "middle" - é¼ æ ‡æŒ‰é”®
  - direction: "up" | "down" - æ»šåŠ¨æ–¹å‘

  å·¥å…·æ‰§è¡Œç»“æœ

  æ‰€æœ‰å·¥å…·éƒ½è¿”å›ToolResultç±»å‹ï¼ŒåŒ…å«ï¼š
  - content: Array<{ type: "text", text: string }> - æ‰§è¡Œç»“æœå†…å®¹
  - å¯èƒ½åŒ…å«é”™è¯¯ä¿¡æ¯æˆ–æ‰§è¡ŒçŠ¶æ€

  è¿™å¥—å·¥å…·ç³»ç»Ÿä¸ºBrowser Agentæä¾›äº†å®Œæ•´çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–èƒ½åŠ›ï¼Œå¯ä»¥å¤„ç†ä»ç®€å•å¯¼èˆªåˆ°å¤æ‚äº¤äº’çš„å„ç§ä»»åŠ¡ã€‚



## æé—®

 é‚£æˆ‘å¦‚ä½•æƒ³åœ¨ç½‘é¡µä¸Šä¸Šä¼ å›¾åƒæ–‡ä»¶ï¼Œè¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿ æœ‰ç°æˆçš„å·¥å…·ä½¿ç”¨å—ï¼Ÿè¿˜æ˜¯è¦å†™è‡ªå®šä¹‰å·¥å…·å‘¢ï¼Ÿ



## å›ç­”

â— ç½‘é¡µæ–‡ä»¶ä¸Šä¼ å®ç°æ–¹æ¡ˆ ğŸ“

  ğŸ“Š ç°çŠ¶åˆ†æ

  ç›®å‰Ekoæ¡†æ¶æ²¡æœ‰ä¸“é—¨çš„æ–‡ä»¶ä¸Šä¼ å·¥å…·ï¼Œç°æœ‰å·¥å…·åªèƒ½ï¼š
  - âœ… ç‚¹å‡»æ–‡ä»¶è¾“å…¥æ¡†ï¼ˆclick_elementï¼‰
  - âœ… è¾“å…¥æ™®é€šæ–‡æœ¬ï¼ˆinput_textï¼‰
  - âŒ é€‰æ‹©æ–‡ä»¶è·¯å¾„
  - âŒ å¤„ç†æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
  - âŒ ä¸Šä¼ æ–‡ä»¶å†…å®¹

  ğŸ› ï¸ å®ç°æ–¹æ¡ˆ

  æ–¹æ¡ˆ1: Node.jsç¯å¢ƒï¼ˆæ¨èï¼‰- åŸºäºPlaywright

  åœ¨Node.jsç¯å¢ƒä¸‹å¯ä»¥ç›´æ¥è®¾ç½®æ–‡ä»¶è·¯å¾„ï¼Œè¿™æ˜¯æœ€å¯é çš„æ–¹æ¡ˆï¼š

~~~
import { BaseBrowserLabelsAgent } from "@eko-ai/eko";
  import path from "path";

  export default class FileUploadBrowserAgent extends BaseBrowserLabelsAgent {
    constructor() {
      super(undefined, [
        {
          name: "upload_file",
          description: "ä¸Šä¼ æ–‡ä»¶åˆ°ç½‘é¡µinput[type=file]å…ƒç´ ",
          parameters: {
            type: "object",
            properties: {
              index: {
                type: "number",
                description: "æ–‡ä»¶è¾“å…¥æ¡†çš„å…ƒç´ ç´¢å¼•"
              },
              filePath: {
                type: "string",
                description: "è¦ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰"
              }
            },
            required: ["index", "filePath"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(async () => {
              const result = await this.execute_script(
                agentContext,
                (params: { index: number; filePath: string }) => {
                  const element = (window as any).get_highlight_element(params.index);
                  if (!element || element.type !== 'file') {
                    return { success: false, error: "å…ƒç´ ä¸æ˜¯æ–‡ä»¶è¾“å…¥æ¡†" };
                  }

                  // åœ¨Playwrightç¯å¢ƒä¸­ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®fileså±æ€§
                  return { success: true, element: element.tagName };
                },
                [{ index: args.index, filePath: args.filePath }]
              );

              // å®é™…çš„æ–‡ä»¶è®¾ç½®éœ€è¦åœ¨Playwrightå±‚é¢å®ç°
              return {
                success: true,
                message: `æ–‡ä»¶ ${args.filePath} å·²å‡†å¤‡ä¸Šä¼ åˆ°å…ƒç´  ${args.index}`
              };
            });
          }
        }
      ]);
    }

    // æ‰©å±•Playwrightç‰¹å®šçš„æ–‡ä»¶ä¸Šä¼ æ–¹æ³•
    protected async setInputFiles(
      agentContext: AgentContext,
      index: number,
      filePaths: string[]
    ): Promise<void> {
      await this.execute_script(
        agentContext,
        async (params: { index: number; filePaths: string[] }) => {
          const element = (window as any).get_highlight_element(params.index);
          if (element && element.type === 'file') {
            // è¿™é‡Œéœ€è¦ä¸Playwrightçš„page.setInputFilesé…åˆä½¿ç”¨
            element.setAttribute('data-file-paths', JSON.stringify(params.filePaths));
            return true;
          }
          return false;
        },
        [{ index, filePaths }]
      );
    }
  }
~~~

æ–¹æ¡ˆ2: Chromeæ‰©å±•ç¯å¢ƒ

  Chromeæ‰©å±•éœ€è¦ç‰¹æ®Šçš„æ–‡ä»¶è®¿é—®æƒé™ï¼š



~~~
import { BaseBrowserLabelsAgent } from "@eko-ai/eko";

  export default class ChromeFileUploadAgent extends BaseBrowserLabelsAgent {
    constructor() {
      super(undefined, [
        {
          name: "upload_image_from_base64",
          description: "ä»base64æ•°æ®ä¸Šä¼ å›¾ç‰‡",
          parameters: {
            type: "object",
            properties: {
              index: { type: "number", description: "æ–‡ä»¶è¾“å…¥æ¡†ç´¢å¼•" },
              base64Data: { type: "string", description: "base64ç¼–ç çš„å›¾ç‰‡æ•°æ®" },
              fileName: { type: "string", description: "æ–‡ä»¶å", default: "image.png" },
              mimeType: { type: "string", description: "MIMEç±»å‹", default: "image/png" }
            },
            required: ["index", "base64Data"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(async () => {
              const result = await this.execute_script(
                agentContext,
                uploadFileFromBase64,
                [args]
              );
              return result;
            });
          }
        },
        {
          name: "trigger_file_dialog",
          description: "è§¦å‘æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼ˆéœ€è¦ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©ï¼‰",
          parameters: {
            type: "object",
            properties: {
              index: { type: "number", description: "æ–‡ä»¶è¾“å…¥æ¡†ç´¢å¼•" }
            },
            required: ["index"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(async () => {
              await this.click_element(agentContext, args.index as number, 1, "left");
              return {
                success: true,
                message: "æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶"
              };
            });
          }
        }
      ]);
    }
  }

  // Chromeæ‰©å±•ä¸­çš„æ–‡ä»¶ä¸Šä¼ è¾…åŠ©å‡½æ•°
  function uploadFileFromBase64(params: {
    index: number;
    base64Data: string;
    fileName: string;
    mimeType: string;
  }) {
    try {
      const { index, base64Data, fileName, mimeType } = params;
      const element = (window as any).get_highlight_element(index);

      if (!element || element.type !== 'file') {
        return { success: false, error: "å…ƒç´ ä¸æ˜¯æ–‡ä»¶è¾“å…¥æ¡†" };
      }

      // å°†base64è½¬æ¢ä¸ºBlob
      const binaryString = atob(base64Data);
      const bytes = new Uint8Array(binaryString.length);
      for (let i = 0; i < binaryString.length; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      const blob = new Blob([bytes], { type: mimeType });

      // åˆ›å»ºFileå¯¹è±¡
      const file = new File([blob], fileName, { type: mimeType });

      // åˆ›å»ºFileList
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);

      // è®¾ç½®æ–‡ä»¶
      element.files = dataTransfer.files;

      // è§¦å‘changeäº‹ä»¶
      element.dispatchEvent(new Event('change', { bubbles: true }));

      return {
        success: true,
        fileName: fileName,
        fileSize: file.size
      };
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }

~~~

  æ–¹æ¡ˆ3: Webç¯å¢ƒï¼ˆå—é™ï¼‰

  åœ¨Webç¯å¢ƒä¸­ç”±äºå®‰å…¨é™åˆ¶ï¼Œåªèƒ½é€šè¿‡é—´æ¥æ–¹å¼ï¼š



~~~
  export default class WebFileUploadAgent extends BaseBrowserLabelsAgent {
    constructor() {
      super(undefined, [
        {
          name: "setup_file_upload_listener",
          description: "è®¾ç½®æ–‡ä»¶ä¸Šä¼ ç›‘å¬å™¨",
          parameters: {
            type: "object",
            properties: {
              index: { type: "number", description: "æ–‡ä»¶è¾“å…¥æ¡†ç´¢å¼•" }
            },
            required: ["index"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(async () => {
              const result = await this.execute_script(
                agentContext,
                setupFileUploadListener,
                [args.index]
              );
              return result;
            });
          }
        },
        {
          name: "create_file_from_url",
          description: "ä»URLåˆ›å»ºæ–‡ä»¶å¹¶ä¸Šä¼ ",
          parameters: {
            type: "object",
            properties: {
              index: { type: "number", description: "æ–‡ä»¶è¾“å…¥æ¡†ç´¢å¼•" },
              imageUrl: { type: "string", description: "å›¾ç‰‡URL" },
              fileName: { type: "string", description: "æ–‡ä»¶å", default: "image.jpg" }
            },
            required: ["index", "imageUrl"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(async () => {
              const result = await this.execute_script(
                agentContext,
                uploadFromUrl,
                [args]
              );
              return result;
            });
          }
        }
      ]);
    }
  }

  function setupFileUploadListener(index: number) {
    const element = (window as any).get_highlight_element(index);
    if (!element || element.type !== 'file') {
      return { success: false, error: "å…ƒç´ ä¸æ˜¯æ–‡ä»¶è¾“å…¥æ¡†" };
    }

    element.addEventListener('change', function(event: any) {
      const files = event.target.files;
      console.log('æ–‡ä»¶å·²é€‰æ‹©:', files);
      // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†æ–‡ä»¶é€‰æ‹©åçš„é€»è¾‘
    });

    return { success: true, message: "æ–‡ä»¶ä¸Šä¼ ç›‘å¬å™¨å·²è®¾ç½®" };
  }

  async function uploadFromUrl(params: {
    index: number;
    imageUrl: string;
    fileName: string;
  }) {
    try {
      const { index, imageUrl, fileName } = params;
      const element = (window as any).get_highlight_element(index);

      if (!element || element.type !== 'file') {
        return { success: false, error: "å…ƒç´ ä¸æ˜¯æ–‡ä»¶è¾“å…¥æ¡†" };
      }

      // ä»URLè·å–æ–‡ä»¶
      const response = await fetch(imageUrl);
      const blob = await response.blob();
      const file = new File([blob], fileName, { type: blob.type });

      // è®¾ç½®æ–‡ä»¶
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      element.files = dataTransfer.files;

      // è§¦å‘changeäº‹ä»¶
      element.dispatchEvent(new Event('change', { bubbles: true }));

      return {
        success: true,
        fileName: fileName,
        fileSize: file.size,
        fileType: blob.type
      };
    } catch (error) {
      return { success: false, error: error.message };
    }
  }

~~~



  ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

  åŸºç¡€ä½¿ç”¨

  // 1. åˆå§‹åŒ–å¸¦æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„Agent
  const agent = new FileUploadBrowserAgent();

  // 2. ç”ŸæˆåŒ…å«æ–‡ä»¶ä¸Šä¼ ä»»åŠ¡çš„å·¥ä½œæµ
  const workflow = await eko.generate(`
    1. æ‰“å¼€å›¾ç‰‡ä¸Šä¼ ç½‘ç«™
    2. ä¸Šä¼ æœ¬åœ°å›¾ç‰‡æ–‡ä»¶ /path/to/image.jpg
    3. ç‚¹å‡»æäº¤æŒ‰é’®
  `);

  // 3. æ‰§è¡Œå·¥ä½œæµ
  await eko.execute(workflow);

  é«˜çº§ä½¿ç”¨

  // é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°æ–‡ä»¶ä¸Šä¼ ä»»åŠ¡
  const workflow = await eko.generate(`
    åœ¨ç¤¾äº¤åª’ä½“ç½‘ç«™ä¸Šï¼š
    1. å¯¼èˆªåˆ°å‘å¸–é¡µé¢
    2. ç‚¹å‡»"æ·»åŠ å›¾ç‰‡"æŒ‰é’®
    3. ä¸Šä¼ ç”¨æˆ·å¤´åƒå›¾ç‰‡
    4. æ·»åŠ å›¾ç‰‡æè¿°ï¼š"æˆ‘çš„æ–°å¤´åƒ"
    5. å‘å¸ƒå¸–å­
  `);

  âš ï¸ æ³¨æ„äº‹é¡¹

  1. æƒé™è¦æ±‚

    - Chromeæ‰©å±•éœ€è¦"permissions": ["activeTab", "scripting"]
    - Node.jsç¯å¢ƒéœ€è¦æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™
  2. å®‰å…¨é™åˆ¶

    - Webç¯å¢ƒå—åŒæºç­–ç•¥é™åˆ¶
    - æŸäº›ç½‘ç«™å¯èƒ½æœ‰é¢å¤–çš„å®‰å…¨éªŒè¯
  3. æ–‡ä»¶æ ¼å¼

    - ç¡®ä¿ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼è¢«ç›®æ ‡ç½‘ç«™æ”¯æŒ
    - æ³¨æ„æ–‡ä»¶å¤§å°é™åˆ¶
  4. å¼‚æ­¥å¤„ç†

    - æ–‡ä»¶ä¸Šä¼ é€šå¸¸æ˜¯å¼‚æ­¥çš„ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ä¸Šä¼ å®Œæˆ

  æ¨èåœ¨Node.jsç¯å¢ƒä¸­ä½¿ç”¨æ–¹æ¡ˆ1ï¼Œè¿™æ˜¯æœ€ç¨³å®šå’ŒåŠŸèƒ½å®Œæ•´çš„å®ç°æ–¹å¼ã€‚

> æ–¹æ¡ˆ2æ˜¯ä¸æ˜¯æµè§ˆå™¨æ’ä»¶æ–¹æ¡ˆï¼Œæ–¹æ¡ˆ2éœ€è¦çš„ç‰¹æ®Šæƒé™æ˜¯ä¸æ˜¯å¯ä»¥åœ¨æ’ä»¶çš„manifestä¸­å®šä¹‰ï¼Œè¿™ä¸ªæ–¹ä¾¿å®ç°å—ï¼Ÿ

â— æ˜¯çš„ï¼æ–¹æ¡ˆ2ç¡®å®æ˜¯æµè§ˆå™¨æ’ä»¶æ–¹æ¡ˆï¼Œè€Œä¸”å®ç°èµ·æ¥ç›¸å¯¹æ–¹ä¾¿ã€‚è®©æˆ‘è¯¦ç»†ä¸ºæ‚¨è¯´æ˜ï¼š

  ğŸ”Œ Chromeæ‰©å±•æ–‡ä»¶ä¸Šä¼ å®ç°è¯¦è§£

  1. Manifestæƒé™é…ç½®

  åœ¨manifest.jsonä¸­æ·»åŠ å¿…è¦æƒé™ï¼š

  {
    "manifest_version": 3,
    "name": "Eko File Upload Extension",
    "version": "1.0",
    "permissions": [
      "activeTab",
      "scripting",
      "storage"
    ],
    "host_permissions": [
      "<all_urls>"
    ],
    "content_security_policy": {
      "extension_pages": "script-src 'self'; object-src 'self'"
    },
    "background": {
      "service_worker": "background.js"
    },
    "content_scripts": [{
      "matches": ["<all_urls>"],
      "js": ["content.js"]
    }]
  }

  2. ç°æœ‰demoçš„manifeståˆ†æ

  è®©æˆ‘æŸ¥çœ‹ç°æœ‰çš„eko-demosä¸­çš„manifesté…ç½®ï¼š

â— Read(../eko-demos/browser-extension-quickstart/public/manifest.json)
  â¿  Read 45 lines (ctrl+r to expand)

â— å®Œç¾ï¼ç°æœ‰çš„manifestå·²ç»åŒ…å«äº†æ–‡ä»¶ä¸Šä¼ æ‰€éœ€çš„æ‰€æœ‰æƒé™ã€‚ç°åœ¨è®©æˆ‘ä¸ºæ‚¨æä¾›å®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼š

  ğŸ“ å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ æ‰©å±•å®ç°

  3. æ‰©å±•ç°æœ‰çš„Browser Agent

  åŸºäºç°æœ‰çš„/packages/eko-extension/src/browser.tsï¼Œæ·»åŠ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼š

~~~
import { AgentContext, BaseBrowserLabelsAgent } from "@eko-ai/eko";

  export default class BrowserAgent extends BaseBrowserLabelsAgent {
    constructor() {
      super(undefined, [
        // æ·»åŠ æ–‡ä»¶ä¸Šä¼ å·¥å…·
        {
          name: "upload_file",
          description: "ä¸Šä¼ æ–‡ä»¶åˆ°ç½‘é¡µçš„æ–‡ä»¶è¾“å…¥æ¡†",
          parameters: {
            type: "object",
            properties: {
              index: {
                type: "number",
                description: "æ–‡ä»¶è¾“å…¥æ¡†çš„å…ƒç´ ç´¢å¼•"
              },
              filePath: {
                type: "string",
                description: "è¦ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æ˜¯ï¼š1)æœ¬åœ°æ–‡ä»¶è·¯å¾„ 2)base64æ•°æ® 3)URL"
              },
              fileName: {
                type: "string",
                description: "æ–‡ä»¶åï¼ˆå½“ä½¿ç”¨base64æˆ–URLæ—¶å¿…éœ€ï¼‰",
                default: "file.jpg"
              },
              fileType: {
                type: "string",
                description: "æ–‡ä»¶ç±»å‹ï¼Œå¦‚ï¼šimage/jpeg, image/png, application/pdf",
                default: "image/jpeg"
              }
            },
            required: ["index", "filePath"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(() =>
              this.uploadFile(
                agentContext,
                args.index as number,
                args.filePath as string,
                args.fileName as string,
                args.fileType as string
              )
            );
          }
        },
        {
          name: "upload_multiple_files",
          description: "ä¸Šä¼ å¤šä¸ªæ–‡ä»¶åˆ°æ”¯æŒå¤šé€‰çš„æ–‡ä»¶è¾“å…¥æ¡†",
          parameters: {
            type: "object",
            properties: {
              index: {
                type: "number",
                description: "æ–‡ä»¶è¾“å…¥æ¡†çš„å…ƒç´ ç´¢å¼•"
              },
              files: {
                type: "array",
                description: "æ–‡ä»¶åˆ—è¡¨",
                items: {
                  type: "object",
                  properties: {
                    path: { type: "string", description: "æ–‡ä»¶è·¯å¾„/base64/URL" },
                    name: { type: "string", description: "æ–‡ä»¶å" },
                    type: { type: "string", description: "æ–‡ä»¶ç±»å‹" }
                  }
                }
              }
            },
            required: ["index", "files"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(() =>
              this.uploadMultipleFiles(agentContext, args.index as number, args.files as any[])
            );
          }
        }
      ]);
    }

    // å•æ–‡ä»¶ä¸Šä¼ å®ç°
    protected async uploadFile(
      agentContext: AgentContext,
      index: number,
      filePath: string,
      fileName: string = "file.jpg",
      fileType: string = "image/jpeg"
    ): Promise<any> {
      return await this.execute_script(
        agentContext,
        uploadFileHelper,
        [{ index, filePath, fileName, fileType }]
      );
    }

    // å¤šæ–‡ä»¶ä¸Šä¼ å®ç°
    protected async uploadMultipleFiles(
      agentContext: AgentContext,
      index: number,
      files: Array<{path: string, name: string, type: string}>
    ): Promise<any> {
      return await this.execute_script(
        agentContext,
        uploadMultipleFilesHelper,
        [{ index, files }]
      );
    }

    // ç°æœ‰æ–¹æ³•ä¿æŒä¸å˜...
    // (screenshot, navigate_to, execute_scriptç­‰æ–¹æ³•)
  }
~~~

4. æ ¸å¿ƒä¸Šä¼ é€»è¾‘å®ç°

~~~
  // å•æ–‡ä»¶ä¸Šä¼ è¾…åŠ©å‡½æ•°
  async function uploadFileHelper(params: {
    index: number;
    filePath: string;
    fileName: string;
    fileType: string;
  }) {
    try {
      const { index, filePath, fileName, fileType } = params;
      const element = (window as any).get_highlight_element(index);

      if (!element || element.type !== 'file') {
        return { success: false, error: "ç›®æ ‡å…ƒç´ ä¸æ˜¯æ–‡ä»¶è¾“å…¥æ¡†" };
      }

      let file: File;

      // å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶æº
      if (filePath.startsWith('data:')) {
        // Base64æ•°æ®
        file = await createFileFromBase64(filePath, fileName, fileType);
      } else if (filePath.startsWith('http')) {
        // URL
        file = await createFileFromUrl(filePath, fileName);
      } else {
        // æ¨¡æ‹Ÿæœ¬åœ°æ–‡ä»¶ï¼ˆåœ¨æ‰©å±•ç¯å¢ƒä¸­çš„æ›¿ä»£æ–¹æ¡ˆï¼‰
        return { success: false, error: "Chromeæ‰©å±•æš‚ä¸æ”¯æŒç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œè¯·ä½¿ç”¨base64æˆ–URL" };
      }

      // è®¾ç½®æ–‡ä»¶åˆ°inputå…ƒç´ 
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      element.files = dataTransfer.files;

      // è§¦å‘changeäº‹ä»¶
      element.dispatchEvent(new Event('change', { bubbles: true }));
      element.dispatchEvent(new Event('input', { bubbles: true }));

      return {
        success: true,
        fileName: file.name,
        fileSize: file.size,
        fileType: file.type,
        message: `æ–‡ä»¶ ${file.name} (${file.size} bytes) å·²æˆåŠŸä¸Šä¼ `
      };
    } catch (error) {
      return {
        success: false,
        error: `ä¸Šä¼ å¤±è´¥: ${error.message}`
      };
    }
  }

  // å¤šæ–‡ä»¶ä¸Šä¼ è¾…åŠ©å‡½æ•°
  async function uploadMultipleFilesHelper(params: {
    index: number;
    files: Array<{path: string, name: string, type: string}>;
  }) {
    try {
      const { index, files } = params;
      const element = (window as any).get_highlight_element(index);

      if (!element || element.type !== 'file') {
        return { success: false, error: "ç›®æ ‡å…ƒç´ ä¸æ˜¯æ–‡ä»¶è¾“å…¥æ¡†" };
      }

      if (!element.multiple) {
        return { success: false, error: "ç›®æ ‡è¾“å…¥æ¡†ä¸æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©" };
      }

      const dataTransfer = new DataTransfer();
      const uploadedFiles = [];

      for (const fileInfo of files) {
        try {
          let file: File;

          if (fileInfo.path.startsWith('data:')) {
            file = await createFileFromBase64(fileInfo.path, fileInfo.name, fileInfo.type);
          } else if (fileInfo.path.startsWith('http')) {
            file = await createFileFromUrl(fileInfo.path, fileInfo.name);
          } else {
            continue; // è·³è¿‡ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹
          }

          dataTransfer.items.add(file);
          uploadedFiles.push({
            name: file.name,
            size: file.size,
            type: file.type
          });
        } catch (error) {
          console.warn(`æ— æ³•ä¸Šä¼ æ–‡ä»¶ ${fileInfo.name}:`, error);
        }
      }

      element.files = dataTransfer.files;
      element.dispatchEvent(new Event('change', { bubbles: true }));
      element.dispatchEvent(new Event('input', { bubbles: true }));

      return {
        success: true,
        uploadedFiles,
        totalFiles: uploadedFiles.length,
        message: `æˆåŠŸä¸Šä¼  ${uploadedFiles.length} ä¸ªæ–‡ä»¶`
      };
    } catch (error) {
      return {
        success: false,
        error: `æ‰¹é‡ä¸Šä¼ å¤±è´¥: ${error.message}`
      };
    }
  }

  // ä»Base64åˆ›å»ºæ–‡ä»¶
  async function createFileFromBase64(base64Data: string, fileName: string, fileType: string):
  Promise<File> {
    const base64Content = base64Data.split(',')[1] || base64Data;
    const binaryString = atob(base64Content);
    const bytes = new Uint8Array(binaryString.length);

    for (let i = 0; i < binaryString.length; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }

    const blob = new Blob([bytes], { type: fileType });
    return new File([blob], fileName, { type: fileType });
  }

  // ä»URLåˆ›å»ºæ–‡ä»¶
  async function createFileFromUrl(url: string, fileName: string): Promise<File> {
    const response = await fetch(url);
    const blob = await response.blob();
    const finalFileName = fileName || url.split('/').pop() || 'file';
    return new File([blob], finalFileName, { type: blob.type });
  }

~~~

5. ä½¿ç”¨ç¤ºä¾‹

~~~
  // åœ¨background scriptä¸­ä½¿ç”¨
  export async function uploadImageExample() {
    let eko = new Eko(config);

    // æ–¹å¼1: ä½¿ç”¨base64æ•°æ®ä¸Šä¼ 
    const workflow1 = await eko.generate(`
      1. æ‰“å¼€å›¾ç‰‡ä¸Šä¼ ç½‘ç«™
      2. æ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ æ¡†
      3. ä¸Šä¼ base64æ ¼å¼çš„å›¾ç‰‡æ•°æ®ï¼šdata:image/jpeg;base64,/9j/4AAQSkZJRgABAQEA...
      4. ç‚¹å‡»æäº¤æŒ‰é’®
    `);

    // æ–¹å¼2: ä»URLä¸Šä¼ å›¾ç‰‡
    const workflow2 = await eko.generate(`
      1. å¯¼èˆªåˆ°ç¤¾äº¤åª’ä½“å‘å¸–é¡µé¢
      2. ç‚¹å‡»"æ·»åŠ å›¾ç‰‡"æŒ‰é’®
      3. ä¸Šä¼ ç½‘ç»œå›¾ç‰‡ï¼šhttps://example.com/avatar.jpg
      4. æ·»åŠ å›¾ç‰‡è¯´æ˜å¹¶å‘å¸ƒ
    `);

    // æ–¹å¼3: ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
    const workflow3 = await eko.generate(`
      1. æ‰“å¼€æ–‡ä»¶æ‰¹é‡ä¸Šä¼ é¡µé¢
      2. é€‰æ‹©æ”¯æŒå¤šæ–‡ä»¶çš„ä¸Šä¼ æ¡†
      3. åŒæ—¶ä¸Šä¼ å¤šå¼ å›¾ç‰‡
      4. æ‰¹é‡å¤„ç†ä¸Šä¼ ç»“æœ
    `);

    await eko.execute(workflow1);
  }

  6. æƒé™è¯´æ˜

  ç°æœ‰manifest.jsonå·²ç»åŒ…å«æ‰€éœ€æƒé™ï¼š

  - âœ… "scripting" - æ‰§è¡Œè„šæœ¬æ³¨å…¥
  - âœ… "activeTab" - è®¿é—®å½“å‰æ ‡ç­¾é¡µ
  - âœ… "storage" - å­˜å‚¨é…ç½®ï¼ˆå¯é€‰ï¼‰
  - âœ… "tabs" - æ ‡ç­¾é¡µç®¡ç†
  - âœ… "<all_urls>" - è®¿é—®æ‰€æœ‰ç½‘ç«™

  ä¸éœ€è¦é¢å¤–æƒé™ï¼ ğŸ‰

  7. ä¼˜åŠ¿æ€»ç»“

  - âœ… ç®€å•æ˜“å®ç° - åŸºäºç°æœ‰æ¶æ„æ‰©å±•
  - âœ… æƒé™å……è¶³ - ç°æœ‰manifestå·²åŒ…å«æ‰€éœ€æƒé™
  - âœ… åŠŸèƒ½å®Œæ•´ - æ”¯æŒå•/å¤šæ–‡ä»¶ä¸Šä¼ 
  - âœ… æ ¼å¼çµæ´» - æ”¯æŒbase64/URL/æœ¬åœ°æ–‡ä»¶
  - âœ… å…¼å®¹æ€§å¥½ - é€‚ç”¨äºå¤§å¤šæ•°ç½‘ç«™
  - âœ… è‡ªç„¶è¯­è¨€ - å¯é€šè¿‡æè¿°è‡ªåŠ¨æ‰§è¡Œ

  è¿™ç§æ–¹æ¡ˆç›¸æ¯”Node.jsæ–¹æ¡ˆæ›´é€‚åˆæµè§ˆå™¨ç¯å¢ƒï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç›´æ¥ï¼
~~~

> æˆ‘æƒ³ä½¿ç”¨æ–¹å¼2ï¼Œä»urlä¸Šä¼ å›¾ç‰‡çš„æ–¹å¼å»åšï¼Œä½ å¸®æˆ‘å®ç°ï¼Œåªè¦è¿™ä¸€ä¸ªåŠŸèƒ½

â— å¥½çš„ï¼æˆ‘æ¥ä¸ºæ‚¨å®ç°ä¸“é—¨çš„"ä»URLä¸Šä¼ å›¾ç‰‡"åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼š

  ğŸ–¼ï¸ ä»URLä¸Šä¼ å›¾ç‰‡åŠŸèƒ½å®ç°

  1. æ‰©å±•ç°æœ‰çš„Browser Agent

  åˆ›å»ºæˆ–ä¿®æ”¹ /packages/eko-extension/src/browser.tsï¼š

~~~
  import { AgentContext, BaseBrowserLabelsAgent } from "@eko-ai/eko";

  export default class BrowserAgent extends BaseBrowserLabelsAgent {
    constructor() {
      // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œæ·»åŠ æˆ‘ä»¬çš„è‡ªå®šä¹‰å·¥å…·
      super(undefined, [
        {
          name: "upload_image_from_url",
          description: "ä»ç½‘ç»œURLä¸‹è½½å›¾ç‰‡å¹¶ä¸Šä¼ åˆ°æ–‡ä»¶è¾“å…¥æ¡†",
          parameters: {
            type: "object",
            properties: {
              index: {
                type: "number",
                description: "æ–‡ä»¶è¾“å…¥æ¡†çš„å…ƒç´ ç´¢å¼•"
              },
              imageUrl: {
                type: "string",
                description: "è¦ä¸Šä¼ çš„å›¾ç‰‡URLåœ°å€"
              },
              fileName: {
                type: "string",
                description: "è‡ªå®šä¹‰æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰",
                default: ""
              }
            },
            required: ["index", "imageUrl"]
          },
          execute: async (args, agentContext) => {
            return await this.callInnerTool(() =>
              this.uploadImageFromUrl(
                agentContext,
                args.index as number,
                args.imageUrl as string,
                args.fileName as string
              )
            );
          }
        }
      ]);
    }

    // ä»URLä¸Šä¼ å›¾ç‰‡çš„æ ¸å¿ƒæ–¹æ³•
    protected async uploadImageFromUrl(
      agentContext: AgentContext,
      index: number,
      imageUrl: string,
      customFileName?: string
    ): Promise<any> {
      return await this.execute_script(
        agentContext,
        uploadImageFromUrlScript,
        [{ index, imageUrl, customFileName }]
      );
    }

    // ç°æœ‰çš„æ–¹æ³•ä¿æŒä¸å˜
    protected async screenshot(agentContext: AgentContext) {
      let windowId = await this.getWindowId(agentContext);
      let dataUrl;
      try {
        dataUrl = await chrome.tabs.captureVisibleTab(windowId, {
          format: "jpeg",
          quality: 60,
        });
      } catch (e) {
        await this.sleep(1000);
        dataUrl = await chrome.tabs.captureVisibleTab(windowId, {
          format: "jpeg",
          quality: 60,
        });
      }
      let data = dataUrl.substring(dataUrl.indexOf("base64,") + 7);
      return {
        imageBase64: data,
        imageType: "image/jpeg" as const,
      };
    }

    protected async navigate_to(agentContext: AgentContext, url: string) {
      let windowId = await this.getWindowId(agentContext);
      let tab = await chrome.tabs.create({
        url: url,
        windowId: windowId,
      });
      tab = await this.waitForTabComplete(tab.id);
      await this.sleep(200);
      agentContext.variables.set("windowId", tab.windowId);
      let navigateTabIds = agentContext.variables.get("navigateTabIds") || [];
      navigateTabIds.push(tab.id);
      agentContext.variables.set("navigateTabIds", navigateTabIds);
      return {
        url: url,
        title: tab.title,
        tabId: tab.id
      };
    }

    protected async get_all_tabs(agentContext: AgentContext) {
      let windowId = await this.getWindowId(agentContext);
      let tabs = await chrome.tabs.query({
        windowId: windowId,
      });
      let result: Array<{ tabId: number; url: string; title: string }> = [];
      for (let i = 0; i < tabs.length; i++) {
        let tab = tabs[i];
        result.push({
          tabId: tab.id,
          url: tab.url,
          title: tab.title,
        });
      }
      return result;
    }

    protected async switch_tab(agentContext: AgentContext, tabId: number) {
      let tab = await chrome.tabs.update(tabId, { active: true });
      if (!tab) {
        throw new Error("tabId does not exist: " + tabId);
      }
      agentContext.variables.set("windowId", tab.windowId);
      return {
        tabId: tab.id,
        url: tab.url,
        title: tab.title,
      };
    }

    protected async execute_script(
      agentContext: AgentContext,
      func: (...args: any[]) => void,
      args: any[]
    ): Promise<any> {
      let tabId = await this.getTabId(agentContext);
      let frameResults = await chrome.scripting.executeScript({
        target: { tabId: tabId as number },
        func: func,
        args: args,
      });
      return frameResults[0].result;
    }

    // è¾…åŠ©æ–¹æ³•
    private async getTabId(agentContext: AgentContext): Promise<number | null> {
      let windowId = await this.getWindowId(agentContext);
      let tabs = (await chrome.tabs.query({
        windowId,
        active: true,
        windowType: "normal",
      })) as any[];
      if (tabs.length == 0) {
        tabs = (await chrome.tabs.query({
          windowId,
          windowType: "normal",
        })) as any[];
      }
      return tabs[tabs.length - 1].id as number;
    }

    private async getWindowId(agentContext: AgentContext): Promise<number | null> {
      let windowId = agentContext.variables.get("windowId") as number;
      if (windowId) {
        return windowId;
      }
      let window = await chrome.windows.getLastFocused({
        windowTypes: ["normal"],
      });
      if (!window) {
        window = await chrome.windows.getCurrent({
          windowTypes: ["normal"],
        });
      }
      if (window) {
        return window.id;
      }
      let tabs = (await chrome.tabs.query({
        windowType: "normal",
        currentWindow: true,
      })) as any[];
      if (tabs.length == 0) {
        tabs = (await chrome.tabs.query({
          windowType: "normal",
          lastFocusedWindow: true,
        })) as any[];
      }
      return tabs[tabs.length - 1].windowId as number;
    }

    private async waitForTabComplete(
      tabId: number,
      timeout: number = 8000
    ): Promise<chrome.tabs.Tab> {
      return new Promise(async (resolve, reject) => {
        const time = setTimeout(async () => {
          chrome.tabs.onUpdated.removeListener(listener);
          let tab = await chrome.tabs.get(tabId);
          resolve(tab);
        }, timeout);
        const listener = async (updatedTabId: any, changeInfo: any, tab: any) => {
          if (updatedTabId == tabId && changeInfo.status === "complete") {
            chrome.tabs.onUpdated.removeListener(listener);
            clearTimeout(time);
            resolve(tab);
          }
        };
        let tab = await chrome.tabs.get(tabId);
        if (tab.status === "complete") {
          resolve(tab);
          clearTimeout(time);
          return;
        }
        chrome.tabs.onUpdated.addListener(listener);
      });
    }

    private sleep(time: number): Promise<void> {
      return new Promise((resolve) => setTimeout(() => resolve(), time));
    }
  }

  export { BrowserAgent };
~~~

  2. æ ¸å¿ƒä¸Šä¼ è„šæœ¬

  è¿™æ˜¯æ³¨å…¥åˆ°ç½‘é¡µä¸­æ‰§è¡Œçš„æ ¸å¿ƒè„šæœ¬ï¼š

~~~
  // è¿™ä¸ªå‡½æ•°ä¼šè¢«æ³¨å…¥åˆ°ç½‘é¡µä¸­æ‰§è¡Œ
  async function uploadImageFromUrlScript(params: {
    index: number;
    imageUrl: string;
    customFileName?: string;
  }) {
    try {
      const { index, imageUrl, customFileName } = params;

      // è·å–æ–‡ä»¶è¾“å…¥æ¡†å…ƒç´ 
      const element = (window as any).get_highlight_element(index);
      if (!element) {
        return { success: false, error: `æ— æ³•æ‰¾åˆ°ç´¢å¼•ä¸º ${index} çš„å…ƒç´ ` };
      }

      if (element.type !== 'file') {
        return { success: false, error: "ç›®æ ‡å…ƒç´ ä¸æ˜¯æ–‡ä»¶è¾“å…¥æ¡†" };
      }

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      console.log(`å¼€å§‹ä»URLä¸‹è½½å›¾ç‰‡: ${imageUrl}`);

      // ä»URLè·å–å›¾ç‰‡
      const response = await fetch(imageUrl, {
        mode: 'cors',
        credentials: 'omit'
      });

      if (!response.ok) {
        throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);
      }

      const blob = await response.blob();

      // éªŒè¯æ˜¯å¦ä¸ºå›¾ç‰‡
      if (!blob.type.startsWith('image/')) {
        return {
          success: false,
          error: `URLè¿”å›çš„ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œè€Œæ˜¯: ${blob.type}`
        };
      }

      // ç”Ÿæˆæ–‡ä»¶å
      let fileName = customFileName;
      if (!fileName) {
        // ä»URLä¸­æå–æ–‡ä»¶å
        const urlPath = new URL(imageUrl).pathname;
        fileName = urlPath.split('/').pop() || 'image';

        // å¦‚æœæ²¡æœ‰æ‰©å±•åï¼Œæ ¹æ®MIMEç±»å‹æ·»åŠ 
        if (!fileName.includes('.')) {
          const extension = blob.type.split('/')[1] || 'jpg';
          fileName += `.${extension}`;
        }
      }

      // åˆ›å»ºFileå¯¹è±¡
      const file = new File([blob], fileName, {
        type: blob.type,
        lastModified: Date.now()
      });

      // åˆ›å»ºDataTransferå¯¹è±¡å¹¶æ·»åŠ æ–‡ä»¶
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);

      // è®¾ç½®æ–‡ä»¶åˆ°inputå…ƒç´ 
      element.files = dataTransfer.files;

      // è§¦å‘ç›¸å…³äº‹ä»¶
      element.dispatchEvent(new Event('change', { bubbles: true }));
      element.dispatchEvent(new Event('input', { bubbles: true }));

      // è¿”å›æˆåŠŸç»“æœ
      return {
        success: true,
        fileName: file.name,
        fileSize: file.size,
        fileType: file.type,
        originalUrl: imageUrl,
        message: `æˆåŠŸä¸Šä¼ å›¾ç‰‡: ${file.name} (${Math.round(file.size/1024)}KB)`
      };

    } catch (error) {
      console.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥:', error);
      return {
        success: false,
        error: `ä¸Šä¼ å¤±è´¥: ${error.message}`,
        originalUrl: params.imageUrl
      };
    }
  }
~~~

  3. ä½¿ç”¨ç¤ºä¾‹

  åœ¨æ‚¨çš„workflowä¸­è¿™æ ·ä½¿ç”¨ï¼š

~~~
  // åœ¨ background script ä¸­ (first_workflow.ts)
  import { Eko } from "@eko-ai/eko";
  import { EkoConfig } from "@eko-ai/eko/types";
  import { getLLMConfig } from "@eko-ai/eko/extension";

  export async function uploadImageFromUrlExample() {
    // è·å–é…ç½®
    let config = await getLLMConfig();
    if (!config || !config.apiKey) {
      console.error("è¯·å…ˆé…ç½®API Key");
      return;
    }

    // åˆå§‹åŒ–eko
    let eko = new Eko(config as EkoConfig);

    // ç”ŸæˆåŒ…å«å›¾ç‰‡ä¸Šä¼ çš„å·¥ä½œæµ
    const workflow = await eko.generate(`
      1. å¯¼èˆªåˆ°å›¾ç‰‡ä¸Šä¼ ç½‘ç«™ https://imgbb.com/
      2. æ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ è¾“å…¥æ¡†
      3. ä»è¿™ä¸ªURLä¸Šä¼ å›¾ç‰‡: https://picsum.photos/800/600
      4. ç­‰å¾…ä¸Šä¼ å®Œæˆ
      5. ç‚¹å‡»ä¸Šä¼ æŒ‰é’®
    `);

    // æ‰§è¡Œå·¥ä½œæµ
    await eko.execute(workflow);
  }

  // æˆ–è€…æ›´å…·ä½“çš„ä»»åŠ¡
  export async function uploadAvatarExample() {
    let config = await getLLMConfig();
    let eko = new Eko(config as EkoConfig);

    const workflow = await eko.generate(`
      ä»»åŠ¡ï¼šåœ¨ç¤¾äº¤åª’ä½“ç½‘ç«™æ›´æ¢å¤´åƒ
      1. æ‰“å¼€ç”¨æˆ·è®¾ç½®é¡µé¢
      2. æ‰¾åˆ°å¤´åƒä¸Šä¼ åŒºåŸŸ
      3. ä¸Šä¼ è¿™å¼ å¤´åƒå›¾ç‰‡: https://example.com/new-avatar.jpg
      4. ä¿å­˜æ›´æ”¹
    `);

    await eko.execute(workflow);
  }

~~~

  4. è‡ªç„¶è¯­è¨€è°ƒç”¨ç¤ºä¾‹

  // ç¤ºä¾‹1ï¼šç®€å•ä¸Šä¼ 
  const workflow1 = await eko.generate(`
    åœ¨å½“å‰ç½‘é¡µä¸Šä¼ å›¾ç‰‡ https://picsum.photos/400/300
  `);

  // ç¤ºä¾‹2ï¼šæŒ‡å®šæ–‡ä»¶å
  const workflow2 = await eko.generate(`
    ä¸Šä¼ ç½‘ç»œå›¾ç‰‡åˆ°æ–‡ä»¶é€‰æ‹©æ¡†ï¼Œå›¾ç‰‡åœ°å€ï¼šhttps://example.com/photo.jpgï¼Œæ–‡ä»¶åï¼šmy-photo.jpg
  `);

  // ç¤ºä¾‹3ï¼šå®Œæ•´æµç¨‹
  const workflow3 = await eko.generate(`
    1. æ‰“å¼€å›¾ç‰‡åˆ†äº«ç½‘ç«™
        2. ç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"æŒ‰é’®
        3. ä»URLä¸Šä¼ å›¾ç‰‡ï¼šhttps://unsplash.com/photos/sample.jpg
        4. æ·»åŠ å›¾ç‰‡æ ‡é¢˜ï¼š"ç¾ä¸½çš„é£æ™¯"
        5. å‘å¸ƒå›¾ç‰‡
        `);

  5. é”™è¯¯å¤„ç†

  è¿™ä¸ªå®ç°åŒ…å«äº†å®Œå–„çš„é”™è¯¯å¤„ç†ï¼š

  - âœ… ç½‘ç»œé”™è¯¯ - å¤„ç†URLæ— æ³•è®¿é—®çš„æƒ…å†µ
  - âœ… æ–‡ä»¶ç±»å‹éªŒè¯ - ç¡®ä¿URLè¿”å›çš„æ˜¯å›¾ç‰‡
  - âœ… å…ƒç´ éªŒè¯ - ç¡®ä¿ç›®æ ‡æ˜¯æ–‡ä»¶è¾“å…¥æ¡†
  - âœ… CORSå¤„ç† - å¤„ç†è·¨åŸŸè®¿é—®é™åˆ¶
  - âœ… æ–‡ä»¶åç”Ÿæˆ - è‡ªåŠ¨ä»URLæå–æˆ–ä½¿ç”¨è‡ªå®šä¹‰æ–‡ä»¶å

  6. æ”¯æŒçš„å›¾ç‰‡æ ¼å¼

  - âœ… JPEG/JPG
  - âœ… PNG
  - âœ… GIF
  - âœ… WebP
  - âœ… SVG
  - âœ… BMP

  è¿™ä¸ªå®ç°ä¸“é—¨é’ˆå¯¹ä»URLä¸Šä¼ å›¾ç‰‡çš„éœ€æ±‚ï¼Œç®€å•é«˜æ•ˆï¼Œå¯ä»¥ç›´æ¥é›†æˆåˆ°æ‚¨ç°æœ‰çš„ekoæ‰©å±•ä¸­ï¼